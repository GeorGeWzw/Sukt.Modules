@using System;
@using Sukt.CodeGenerator;

@{

    ProjectMetadata metadata = Model;
    string lowerFirstNmae = Sukt.Module.Core.Extensions.StringExtentions.LowerFirstChar(metadata.EntityMetadata.EntityName);
}

@*//------------------------------------------------------------------------------
//<auto-generated>
    //此代码由代码生成器生成。
    //手动更改此文件可能导致应用程序出现意外的行为。
    //如果重新生成代码，将覆盖对此文件的手动更改。
    //
</auto-generated>
//<copyright file="@(metadata.EntityMetadata.EntityName).cs" company="@metadata.Company">
    //@metadata.Copyright
    //
</copyright>
//<site>@metadata.SiteUrl</site>
//<last-editor>@metadata.Creator</last-editor>
//<last-date>@DateTime.Now.ToString("yyyy/MM/dd HH:mm")</last-date>
//------------------------------------------------------------------------------
*@
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Threading.Tasks;
using Sukt.Module.Core.Entity;
using Sukt.Module.Core;
using Sukt.Module.Core.Extensions;
using Sukt.Module.Core.DomainResults;
using Sukt.Module.Core.Extensions.ResultExtensions;

using Sukt.Module.Core.Enums;
using @(metadata.Namespace).Dtos;
using @(metadata.Namespace).Domain.Models;



namespace @(metadata.Namespace).Application
{

    /// &lt;summary&gt;
    ///@(string.IsNullOrEmpty(metadata.EntityMetadata.DisplayName) ? metadata.EntityMetadata.EntityName : metadata.EntityMetadata.DisplayName)
    /// &lt;/summary&gt;
    [DisplayName("@(metadata.EntityMetadata.DisplayName)")]
    public class @(metadata.EntityMetadata.EntityName)Contract :I@(metadata.EntityMetadata.EntityName)Contract
    {
        @{
            if(metadata.EntityMetadata.IsAggregate)
            {
  <text>private readonly IAggregateRootRepository<@(metadata.EntityMetadata.EntityName), @(metadata.EntityMetadata.PrimaryKeyType)> _@(lowerFirstNmae)Repository;</text>
  <text>public @(metadata.EntityMetadata.EntityName)Contract(IAggregateRootRepository<@(metadata.EntityMetadata.EntityName), @(metadata.EntityMetadata.PrimaryKeyType)> @(lowerFirstNmae)Repository)</text>
  <text>{</text>
        <text>_@(lowerFirstNmae)Repository=@(lowerFirstNmae)Repository;</text>
  <text>}</text>
            }
            else
            {
        <text>private readonly IEFCoreRepository<@(metadata.EntityMetadata.EntityName), @(metadata.EntityMetadata.PrimaryKeyType)> _@(lowerFirstNmae)Repository;</text>
  <text>public @(metadata.EntityMetadata.EntityName)Contract(IEFCoreRepository<@(metadata.EntityMetadata.EntityName), @(metadata.EntityMetadata.PrimaryKeyType)> @(lowerFirstNmae)Repository)</text>
  <text>{</text>
        <text>_@(lowerFirstNmae)Repository=@(lowerFirstNmae)Repository</text>
  <text>}</text>
            }
        }
        /// &lt;summary&gt;
        /// 异步创建@(metadata.EntityMetadata.DisplayName)
        /// &lt;/summary&gt;
        /// &lt;param name="dto"&gt;添加的@(metadata.EntityMetadata.DisplayName)DTO&lt;/param&gt;
        public async Task&lt;OperationResponse&gt; CreateAsync(@(metadata.EntityMetadata.EntityName)InputDto dto)
        {
            dto.NotNull(nameof(dto));
            return await _@(lowerFirstNmae)Repository.InsertAsync(dto.MapTo&lt;@(metadata.EntityMetadata.EntityName)&gt;());
        }

        /// &lt;summary&gt;
        /// 异步更新@(metadata.EntityMetadata.DisplayName)
        /// &lt;/summary&gt;
        /// &lt;param name="dto"&gt;更新的@(metadata.EntityMetadata.DisplayName)DTO&lt;/param&gt;
        public async Task&lt;OperationResponse&gt; UpdateAsync(@metadata.EntityMetadata.PrimaryKeyType id,@(metadata.EntityMetadata.EntityName)InputDto dto)
        {
            dto.NotNull(nameof(dto));
            var entity = await _@(lowerFirstNmae)Repository.GetByIdAsync(id);
            dto.MapTo(entity);
            return await _@(lowerFirstNmae)Repository.UpdateAsync(entity);
        }

        /// &lt;summary&gt;
        /// 异步加载表单@(metadata.EntityMetadata.DisplayName)
        /// &lt;/summary&gt;
        /// &lt;param name="id"&gt;要加载的@(metadata.EntityMetadata.DisplayName)主键&lt;/param&gt;
        public async Task&lt;OperationResponse&lt;@(metadata.EntityMetadata.EntityName)OutputDto&gt;&gt; LoadFormAsync(@metadata.EntityMetadata.PrimaryKeyType id)
        {
            id.NotEmpty(nameof(id));
            var dto = (await _@(lowerFirstNmae)Repository.GetByIdAsync(id)).MapTo&lt;@(metadata.EntityMetadata.EntityName)OutputDto&gt;();
            return new OperationResponse&lt;@(metadata.EntityMetadata.EntityName)OutputDto&gt;("加载成功",dto,OperationEnumType.Success);
        }

        /// &lt;summary&gt;
        /// 异步删除@(metadata.EntityMetadata.DisplayName)
        /// &lt;/summary&gt;
        /// &lt;param name="id"&gt;要删除的@(metadata.EntityMetadata.DisplayName)主键&lt;/param&gt;
        public async Task&lt;OperationResponse&gt; DeleteAsync(@metadata.EntityMetadata.PrimaryKeyType id)
        {
            id.NotEmpty(nameof(id));
            return await _@(lowerFirstNmae)Repository.DeleteAsync(id);
        }

        /// &lt;summary&gt;
        /// 异步得到@(metadata.EntityMetadata.DisplayName)分页数据
        /// &lt;/summary&gt;
        /// &lt;param name="request"&gt;分页请求数据&lt;/param&gt;
        public async Task&lt;IPageResult&lt;@(metadata.EntityMetadata.EntityName)OutputDto&gt;&gt; GetPageAsync(PageRequest request)
        {
            return await _@(lowerFirstNmae)Repository.NoTrackEntities.ToPageAsync&lt;@(metadata.EntityMetadata.EntityName), @(metadata.EntityMetadata.EntityName)OutputDto&gt;(request);
        }

    }
}
